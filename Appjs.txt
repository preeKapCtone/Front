import React, { useState } from 'react';
import axios from 'axios';
import './App.css';

function App() {
    const [message, setMessage] = useState('');
    const [responses, setResponses] = useState([]);
    const [selectedAssistantID, setSelectedAssistantID] = useState('');
    const [assistantName, setAssistantName] = useState(''); // ì„ íƒëœ ì–´ì‹œìŠ¤í„´íŠ¸ ì´ë¦„
    const assistantOptions = [
        { id: "asst_VB5esFXsOGeJaQ4vTdlOyHVY", name: "Frieren" },
        { id: "asst_JRVxwfHwUlMHEywxHpSngRMz", name: "SangSangBoogie" }
    ];

    const sendMessage = async () => {
        if (message.trim() === '' || selectedAssistantID === '') return;

        try {
            // ì„œë²„ì— ë©”ì‹œì§€ ì „ì†¡
            const response = await axios.post(
                'http://127.0.0.1:8000/api/posts',
                {
                    user_message: message,
                    assistant_id: selectedAssistantID
                }
            );

            // ì‘ë‹µ ë©”ì‹œì§€ì™€ ê°ì • ìƒíƒœ
            const botResponse = response.data.response;
            const botSentiment = response.data.sentiment; // ê°ì • ìƒíƒœ

            // ëŒ€í™” ê¸°ë¡ ì—…ë°ì´íŠ¸
            setResponses([
                ...responses,
                { user: message, bot: botResponse, sentiment: botSentiment }
            ]);
            setMessage('');  // ì…ë ¥ì°½ ì´ˆê¸°í™”

        } catch (error) {
            console.error("Error sending message:", error);
            alert("ë©”ì‹œì§€ ì „ì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.");
        }
    };

    // ì–´ì‹œìŠ¤í„´íŠ¸ ì„ íƒ ì‹œ ì–´ì‹œìŠ¤í„´íŠ¸ ì´ë¦„ë„ ì—…ë°ì´íŠ¸
    const handleAssistantChange = (e) => {
        const selectedID = e.target.value;
        setSelectedAssistantID(selectedID);
        const selectedAssistant = assistantOptions.find(option => option.id === selectedID);
        setAssistantName(selectedAssistant ? selectedAssistant.name : '');
    };

    return (
        <div className="chat-container">
            <h1>Chat with Assistant</h1>
            <h2>Selected Assistant: {assistantName}</h2>
            <select onChange={handleAssistantChange} className="assistant-select">
                <option value="">Select an Assistant</option>
                {assistantOptions.map((option) => (
                    <option key={option.id} value={option.id}>
                        {option.name}
                    </option>
                ))}
            </select>
            <div className="chat-box">
                {responses.map((res, index) => (
                    <div key={index} className={`chat-message ${res.sentiment}`}>
                        <div className="user-message">{res.user}</div>
                        <div className="bot-message">
                            {res.bot}
                            <span className="sentiment-icon">
                                {res.sentiment === 'positive' && 'ğŸ˜Š'}
                                {res.sentiment === 'negative' && 'ğŸ˜¡'}
                                {res.sentiment === 'neutral' && 'ğŸ˜'}
                            </span>
                        </div>
                    </div>
                ))}
            </div>
            <div className="input-container">
                <input
                    type="text"
                    value={message}
                    onChange={(e) => setMessage(e.target.value)}
                    placeholder="Type your message"
                    className="message-input"
                />
                <button onClick={sendMessage} className="send-button">Send</button>
            </div>
        </div>
    );
}

export default App;
